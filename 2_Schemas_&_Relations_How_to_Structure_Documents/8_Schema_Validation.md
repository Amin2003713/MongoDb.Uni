در مونگو دی‌بی، اعتبارسنجی طرح، فرایند تعریف و اجرای مجموعه‌ای از قوانین برای ساختار و محتوای اسناد داخل یک مجموعه است.
این فرآیند به حفظ همسانی داده، ادامه معتبریت داده و پایبندی به مدل داده‌ی شما کمک می‌کند.

**مزایای اعتبارسنجی طرح:**

* **همسانی داده:** اعتبارسنجی طرح کمک می‌کند از ورود داده‌های نامعتبر یا غیرمنتظره به مجموعه خود جلوگیری کنید و ساختار
  یکسانی برای اسناد خود حفظ کنید.
* **پرس‌وجوهای بهبود یافته:** داده‌های اعتبارسنجی شده باعث می‌شود نوشتن پرس‌وجوهای کارآمد آسان‌تر شود زیرا شما فرمت و
  نوع داده مورد انتظار فیلدها را می‌دانید.
* **شناسایی خطا:** اعتبارسنجی طرح می‌تواند هنگام درج یا به‌روزرسانی داده، خطاها را کشف کند و از بروز مشکلات محتمل در
  برنامه شما جلوگیری کند.
* **مستندسازی:** یک طرح تعریف شده به عنوان مستندسازی برای مدل داده شما عمل می‌کند و ساختار مورد انتظار و انواع داده را
  برای توسعه‌دهندگان و هر کسی که با داده‌ها کار می‌کند، روشن می‌کند.

**اجزاء اصلی اعتبارسنجی طرح:**

دو رویکرد اصلی برای اعتبارسنجی طرح در مونگو دی‌بی وجود دارد:

1. **اعتبارسنجی اسناد:**
    * شما قوانین اعتبارسنجی را با استفاده از یک زبان تعریف طرح (SDL) مشابه JSON تعریف می‌کنید.
    * این قوانین الزاماتی را برای فیلدها مشخص می‌کنند که شامل موارد زیر است:
        * حضور (الزامی یا اختیاری)
        * نوع داده (رشته، عدد، بولی، و غیره)
        * محدوده یا مقادیر خاص مجاز
        * اعتبارسنجی ساختار اسناد تو در تو
    * اعتبارسنجی در هنگام درج و به‌روزرسانی اسناد رخ می‌دهد و خطاها برای اسنادی که مقررات تعریف‌شده را نقض می‌کنند،
      اعلام می‌شود.

2. **اعتبارسنجی کاتالوگ نوع (اختیاری):**
    * این یک فرم دقیق‌تر از اعتبارسنجی است که در نسخه‌های جدیدتر مونگو دی‌بی موجود است.
    * این نیازمند تعریف یک طرح رسمی با استفاده از YAML و ثبت آن با پایگاه داده است.
    * این رویکرد چک کردن نوع مقادیر فیلد را برای همه‌ی مقادیر فیلد، با ارائه بالاترین سطح کنترل اعتبارسنجی اعمال می‌کند.

**استفاده از اعتبارسنجی طرح:**

دستورات خاص برای استفاده از اعتبارسنجی طرح به روش انتخاب شده و نسخه مونگو دی‌بی که استفاده می‌کنید وابسته است. در اینجا
یک مرور کلی عمومی وجود دارد:

**استفاده از اعتبارسنجی طرح:**

دستورات خاص برای استفاده از اعتبارسنجی طرح به روش انتخاب شده و نسخه مونگو دی‌بی که استفاده می‌کنید وابسته است. در اینجا
یک مرور کلی عمومی وجود دارد:

1. **تعریف طرح:**
   * هنگام ایجاد یک مجموعه، از گزینه `validator` برای تعریف یک سند اعتبارسنجی با استفاده از SDL استفاده کنید.
   * به عنوان یک رویکرد دیگر، برای اعتبارسنجی کاتالوگ نوع، طرح را در یک فایل YAML تعریف کرده و آن را با پایگاه داده ثبت
     کنید.

2. **اجرای اعتبارسنجی:**
   * مونگو دی‌بی به طور خودکار در هنگام عملیات درج و به‌روزرسانی بر روی مجموعه، قوانین اعتبارسنجی را اعمال می‌کند.
   * اسنادی که مقررات طرح را نقض می‌کنند، با ی

**ملاحظات:**

* اعتبارسنجی طرح مقداری هزینه اضافی به عملیات نوشتن و به‌روزرسانی اضافه می‌کند.
* این ممکن است برای همه‌ی مجموعه‌ها لازم نباشد، به ویژه برای مجموعه‌هایی که ساختار داده‌ای بسیار پویا دارند.
* شما می‌توانید تصمیم بگیرید که اعتبارسنجی را برای عملیات خاصی غیرفعال کنید اگر نیاز باشد.
* به طور کلی، اعتبارسنجی طرح ابزاری ارزشمند برای حفظ کیفیت و همسانی داده‌ها در مجموعه‌های مونگو دی‌بی شما است. این کمک
  می‌کند تا از مشکلات امانت داده جلوگیری شود، عملکرد پرس‌وجو را بهبود بخشد و مستندسازی بهتری برای مدل داده شما فراهم
  کند.

اعتبارسنجی سند مجموعه در مونگو دی‌بی به طور خاص به استفاده از ویژگی اعتبارسنجی سند برای تعریف و اعمال قوانین برای ساختار
و محتوای اسناد در یک مجموعه اشاره دارد. این رویکرد از یک زبان تعریف طرح (SDL) مشابه با JSON برای مشخص کردن معیارهای
اعتبارسنجی استفاده می‌کند.

در ادامه، توضیح مفصلی از اعتبارسنجی سند مجموعه آورده شده است:

**تعریف طرح:**

- طرح برای اعتبارسنجی سند به عنوان یک سند خود تعریف می‌شود، معمولاً با استفاده از گزینه `validator` هنگام ایجاد یک
  مجموعه یا تغییر یک مجموعه موجود.
- سند طرح از SDL استفاده می‌کند که معیارهای اعتبارسنجی را برای هر فیلد در اسناد شما مشخص می‌کند.

**قوانین اعتبارسنجی:**

- شما می‌توانید برای هر فیلد قوانین اعتبارسنجی مختلفی را تعریف کنید که شامل موارد زیر است:
    - **حضور:** آیا فیلد لازم است (`required: true`) یا اختیاری (`required: false`) باشد.
    - **نوع داده:** نوع داده مورد انتظار برای فیلد را مشخص می‌کند (مانند `type: string`، `type: number`).
    - **محدوده یا مقادیر:** محدوده‌ای از مقادیر مجاز برای فیلدهای عددی را تعیین می‌کند (`minimum`، `maximum`) یا را به
      یک مجموعه خاص از مقادیر معتبر محدود می‌کند (`enum`).
    - **ساختار سند تو در تو:** همچنین می‌توانید ساختار اسناد تو در تو درون سند اصلی را با استفاده از زیرسند در تعریف طرح
      اعتبارسنجی کنید.

**طرح مثال:**

```javascript
{
  "validator": {
    "$jsonSchema": {
      "bsonType": "object",
      "required": ["name", "email"],
      "properties": {
        "name": {
          "bsonType": "string",
          "minLength": 3,
          "maxLength": 50
        },
        "email": {
          "bsonType": "string",
          "format": "email"
        },
        "age": {
          "bsonType": "int",
          "minimum": 18
        }
      }
    }
  }
}
```

این طرح مثال، اجبار می‌دهد که اسناد در مجموعه باید دارای فیلدهای "name" و "email" باشند. فیلد "name" باید یک رشته با طول
بین ۳ تا ۵۰ کاراکتر باشد، در حالی که "email" باید یک فرمت آدرس ایمیل معتبر داشته باشد. به علاوه، فیلد اختیاری "age" اگر
وجود داشته باشد، باید یک عدد صحیح بزرگتر یا مساوی با ۱۸ باشد.

**اجرای اعتبارسنجی:**

- مونگو دی‌بی به طور خودکار قوانین اعتبارسنجی تعریف شده را در هنگام عملیات درج و به‌روزرسانی در مجموعه اجرا می‌کند.
- هر اسنادی که مقررات طرح را نقض کند، با یک پیام خطا که مشخص می‌کند کدام قانون اعتبارسنجی شکست خورده است، رد می‌شود.

**مزایا:**

* **یکنواختی داده:** اعتبارسنجی طرح کمک می‌کند تا داده‌های نامعتبر یا غیرمنتظره از ورود به مجموعه جلوگیری شود، ساختار
  یکنواختی را برای اسناد شما حفظ می‌کند.
* **بهبود کوئری‌ها:** داده‌های اعتبارسنجی شده، نوشتن کوئری‌های کارآمد را آسان‌تر می‌کند زیرا شما فرمت مورد انتظار و
  انواع داده‌های فیلدها را می‌شناسید.
* **تشخیص خطا:** اعتبارسنجی طرح، هنگام درج داده یا به‌روزرسانی، خطاها را شناسایی می‌کند و از بروز مشکلات پتانسیلی در
  برنامه شما جلوگیری می‌کند.

**ملاحظات:**

* اعتبارسنجی طرح، برای عملیات نوشتن و به‌روزرسانی، برخی از بار مرتبط را افزایش می‌دهد.
* ممکن است برای همه مجموعه‌ها ضروری نباشد، به ویژه برای آن‌هایی که ساختار داده‌هایشان بسیار پویا است.
* می‌توانید اعتبارسنجی را برای عملیات خاصی غیرفعال کنید اگر لازم باشد.

**کلیتاً، اعتبارسنجی سند مجموعه ابزاری قدرتمند برای اطمینان از اصالت داده و یکنواختی درون مجموعه‌های مونگو دی‌بی است.
این ابزار به جلوگیری از مشکلات کیفیت داده، بهبود عملکرد کوئری و ارائه تعریف بهتری از ساختار برای داده‌های شما کمک
می‌کند.**

به طور پیش‌فرض، MongoDB اسنادی را که با قوانین اعتبارسنجی تعریف شده در طرح، در هنگام عملیات درج و به‌روزرسانی نقض
می‌کنند، رد می‌کند. با این حال، شما کنترلی بر روی نحوه مدیریت خطاهای اعتبارسنجی دارید. در ادامه، می‌توانید ببینید چگونه
می‌توانید عمل اعتبارسنجی را تغییر دهید:

**سطوح اعتبارسنجی:**

MongoDB دو سطح اعتبارسنجی را ارائه می‌دهد که نحوه مدیریت خطاها را تحت تأثیر قرار می‌دهند:

1. **سخت (پیش‌فرض):** این رفتار پیش‌فرض است که در آن اسنادی که به طرح تعریف شده را نقض می‌کنند، رد می‌شوند و عملیات با
   پیام خطا شکست می‌خورد.
2. **متوسط:** در این سطح، MongoDB هنوز اعتبارسنجی را انجام می‌دهد، اما به جای رد کردن اسناد، یک پیام هشدار ثبت می‌کند و
   به عملیات درج یا به‌روزرسانی ادامه می‌دهد.

**تغییر سطح اعتبارسنجی:**

دو روش اصلی برای تغییر سطح اعتبارسنجی برای یک مجموعه وجود دارد:

1. **استفاده از گزینه `validator`:**

هنگام ایجاد یا تغییر یک مجموعه، می‌توانید سطح اعتبارسنجی را درون گزینه `validator` مشخص کنید:

```javascript
{
  "validator": {
    "$jsonSchema": { ... },  // تعریف طرح شما در اینجا
    "level": "moderate"  // تنظیم سطح اعتبارسنجی به "متوسط"
  }
}
```

2. **استفاده از دستور `collMod`:**

همچنین می‌توانید با استفاده از دستور `collMod`، سطح اعتبارسنجی برای یک مجموعه موجود را تغییر دهید:

```javascript
db.runCommand({
  collMod: "نام مجموعه شما",
  validator: {
    "$jsonSchema": { ... },  // تعریف طرح شما در اینجا
    "level": "moderate"  // تنظیم سطح اعتبارسنجی به "متوسط"
  }
})
```

**ملاحظات مهم:**

* تغییر سطح اعتبارسنجی به متوسط اجازه ورود داده‌های احتمالاً نامعتبر به مجموعه شما را می‌دهد.
* از این رویکرد با احتیاط استفاده کنید و فقط اگر مکانیسم‌هایی برای مدیریت ابهامات داده که ممکن است به دلیل نقض طرح ایجاد
  شوند وجود داشته باشد.
* در نظر داشته باشید که ثبت هشدارهای اعتبارسنجی برای اعتبارسنجی متوسط، به منظور نظارت بر مشکلات کیفیت داده، مفید است.

**رویکرد جایگزین: توابع اعتبارسنجی سفارشی**

اگرچه تغییر سطح اعتبارسنجی رویکرد ابتدایی‌ای برای مدیریت خطاها است، رویکردی انعطاف‌پذیرتر شامل استفاده از توابع
اعتبارسنجی سفارشی است. این توابع به شما امکان می‌دهند تا منطق مدیریت خطاهایی را تعریف کنید که فراتر از فقط رد یا قبول
کردن اسناد می‌روند.

**کلیتاً، قبل از پیاده‌سازی، تأثیر تغییر عمل اعتبارسنجی را بشناسید. در نظر داشته باشید که برای کنترل بهتر بر مدیریت
خطاها و کیفیت داده، از توابع اعتبارسنجی سفارشی استفاده کنید.**
---

اعمال اعتبارسنجی جامع در MongoDB: خصوصیت‌ها و انواع داده‌ها
قابلیت‌های اعتبارسنجی طرح‌ها در MongoDB، به ویژه از طریق اعتبارسنجی سند با استفاده از زبان تعریف طرح (SDL)، رویکردی قوی
را برای اطمینان از اصالت و سازگاری داده‌ها در مجموعه‌های شما فراهم می‌کند. این سند به بررسی خصوصیات اصلی و انواع
داده‌های موجود برای ساخت قوانین اعتبارسنجی جامع می‌پردازد، که به‌موجب آن رویکرد حرفه‌ای به مدیریت داده‌ها ترویج می‌یابد.

خصوصیات اصلی اعتبارسنجی:

bsonType: این خصوصیت اساسی نوع داده BSON مورد انتظار برای هر فیلد در سند شما را مشخص می‌کند. این خصوصیت به عنوان سنگ
بنای اعتبارسنجی عمل می‌کند و بنیان اساسی ساختار داده‌های شما را تعیین می‌کند (به عنوان مثال string، int، double، bool،
date، object، array).

required (اختیاری): این خصوصیت بولین به عنوان یک دروازه حفاظتی عمل می‌کند و حضور فیلدهای حیاتی (true) یا اجازه انعطاف
پذیری برای فیلدهای کم اهمیت‌تر (false) را مشخص می‌کند. این اطمینان را به حفظ داده‌های اصلی می‌دهد در حالی که انعطاف
پذیری برای فیلدهای کم اهمیت‌تر را حفظ می‌کند.

کنترل دقیق با تصحیح‌های وابسته به نوع داده:

بیشتر از bsonType، انواع داده‌ها خصوصیات اضافی برای کنترل دقیق‌تر بر روی رفتار اعتبارسنجی ارائه می‌دهند:

رشته (String):

minLength: کمینه طول مجاز برای رشته.
maxLength: حداکثر طول مجاز برای رشته.
pattern: استفاده از عبارات منظم برای اعتبارسنجی فرمت رشته (به عنوان مثال، آدرس‌های ایمیل).
عدد (Number):

minimum: کمینه مقدار عددی مجاز.
maximum: بیشینه مقدار عددی مجاز.
تاریخ (Date):

minDate: کمینه مقدار تاریخ مجاز.
maxDate: بیشینه مقدار تاریخ مجاز.
آرایه (Array):

minItems: کمینه تعداد عناصر آرایه.
maxItems: بیشینه تعداد عناصر آرایه.
items: طرح تو در تو برای عناصر آرایه، تعیین ویژگی‌ها و قوانین اعتبارسنجی برای هر عنصر را تعریف می‌کند.

* **آرایه (Array):**
  در حالی که `bsonType` خود آرایه را تعریف می‌کند، می‌توانید با گنجاندن یک طرح تو در تو، به عمق بیشتری بپردازید. این طرح
  تو در تو به عنوان یک الگو عمل می‌کند که با دقت ساختار و محتوای عناصر داخل آرایه را اعتبارسنجی می‌کند. در واقع،
  ویژگی‌ها و قوانین اعتبارسنجی مورد انتظار را برای هر عنصر فردی تعیین می‌کند.

**مثال توضیحی با طرح‌های تو در تو:**

```javascript
{
  "validator": {
    "$jsonSchema": {
      "bsonType": "object",
      "required": ["name", "comments"],
      "properties": {
        "name": {
          "bsonType": "string",
          "minLength": 3
        },
        "comments": {
          "bsonType": "array",
          "minItems": 1,  // تعداد کمینه عناصر
          "maxItems": 5,  // تعداد بیشینه عناصر
          "items": {  // طرح تو در تو برای عناصر آرایه
            "bsonType": "object",
            "required": ["text"],
            "properties": {
              "text": {
                "bsonType": "string",
                "minLength": 10
              }
            }
          }
        }
      }
    }
  }
}
```

در این مثال، فیلد "comments" یک آرایه است که باید حاوی بین 1 تا 5 عنصر باشد. هر عنصر به تنهایی یک سند تو در تو است که
نیاز به یک فیلد "text" با حداقل طول 10 کاراکتر دارد. طرح تو در تو به شما امکان می‌دهد قوانین اعتبارسنجی پیچیده را برای
ساختارهای داده‌ای خود تعریف کنید.

**فراتر از مبانی:**

* **شبیه‌سازی Enums:** در حالی که SDL به طور مستقیم از enums (مجموعه‌های مقادیر پیش‌تعریف شده) پشتیبانی نمی‌کند،
  می‌توانید اثر شبیه‌سازی شده‌ای از آن را برای انواع داده خاص (به عنوان مثال، رشته‌ها) با ترکیب `required: true` با یک
  مجموعه محدود از مقادیر مجاز ایجاد کنید. این امر با استفاده از ترکیبی از `minLength`، `maxLength`، و عبارت
  منظم (`pattern`) در تعریف طرح امکان پذیر است.

* **توابع اعتبارسنجی سفارشی:** برای حالاتی که نیاز به منطق اعتبارسنجی پیچیده‌تری از این خصوصیات دارید، بررسی استفاده از
  توابع اعتبارسنجی سفارشی در MongoDB را در نظر بگیرید. این توابع به شما امکان می‌دهند قوانین اعتبارسنجی بسیار
  سفارشی‌شده‌تری را تعریف کنید که به نیازهای خاص داده‌های شما پاسخ می‌دهد.

با بهره‌گیری موثر از این خصوصیات و انواع داده، می‌توانید قوانین اعتبارسنجی قوی و حرفه‌ای برای مجموعه‌های MongoDB خود
ایجاد کنید. این رویکرد از سازگاری داده، اصالت و انطباق با مدل داده‌ای دقیقاً طراحی ش