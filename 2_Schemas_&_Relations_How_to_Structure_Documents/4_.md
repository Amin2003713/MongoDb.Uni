## روابط در کالکشن‌های MongoDB

روابط در پایگاه داده MongoDB به ارتباطات و وابستگی‌های بین اسناد داخل کالکشن‌ها اشاره دارد. درک اینکه چگونه باید این
روابط را به صورت موثر مدل کرد، برای مدیریت و بازیابی بهینه اطلاعات در MongoDB بسیار حیاتی است.

برخلاف پایگاه داده‌های رابطه‌ای که بر روی جداول با ساختارهای سخت و مشخص و کلیدهای خارجی برای اعمال روابط تکیه می‌کنند،
MongoDB رویکردی انعطاف‌پذیرتر را ارائه می‌دهد. در ادامه چندین استراتژی برای مدل کردن روابط در کالکشن‌های MongoDB آورده
شده است:

**1. اسناد تو در تو:**

- مناسب برای مدل کردن روابط یک به یک یا سناریوهایی که یک اسناد به داده‌های وابسته درون خود نیاز دارد.
- اسناد وابسته به طور کامل درون اسناد اصلی جای می‌گیرند.

**مثال:**

فرض کنید یک اسناد برای یک `کاربر` با فیلدهایی مانند نام، ایمیل و آدرس وجود دارد. آدرس کاربر می‌تواند درون اسناد
اصلی `کاربر` با نام `"آدرس"` جای گیرد.

```json
{
  "_id": ObjectId("63cab8c7e4b021d2a7f78b12"),
  "name": "علی رضایی",
  "email": "ali.rezaei@example.com",
  "address": {
    "city": "تهران",
    "street": "خیابان آزادی",
    "postalCode": 12345
  }
}
```

**2. آرایه‌ها:**

- استفاده می‌شود برای مدل کردن روابط یک به چند.
- یک آرایه درون اسناد اصلی برای نگهداری ارجاع‌ها (معمولاً شناسه‌های اشیاء) یا داده‌های مرتبط با اسناد استفاده می‌شود.

**مثال:**

تصور کنید یک اسناد برای یک `سفارش` با فیلدهایی مانند شناسه سفارش، تاریخ و لیستی از محصولات موجود در سفارش وجود دارد.
لیست محصولات می‌تواند با استفاده از آرایه‌ای به نام `"محصولات"` که حاوی شناسه‌های اسناد محصول است نمایش داده شود.

```json
{
  "_id": ObjectId("63cad8c7e4b021d2a7f78b13"),
  "orderDate": ISODate("2024-03-20T00:00:00Z"),
  "products": [
    ObjectId("63cab8c7e4b021d2a7f78b14"),  // شناسه محصول ۱
    ObjectId("63cab8c7e4b021d2a7f78b15")   // شناسه محصول ۲
  ]
}
```

**3. کالکشن‌های ارجاعی (اختیاری):**

- یک استراتژی برای مدل کردن روابط پیچیده چند به چند.
- از دو کالکشن جداگانه برای مدیریت موجودیت‌ها و یک کالکشن ارجاعی اضافی برای برقراری ارتباط بین آنها استفاده می‌شود.
- کالکشن ارجاعی شامل اسنادی است که هر کدام شامل ارجاع‌ها (معمولاً شناسه‌های اسناد) به اسناد مرتبط از دو کالکشن دیگر
  هستند.

**مثال:**

فرض کنید می‌خواهید رابطه بین `کاربران` و `دوره‌ها` را مدل کنید. این سناریو می‌تواند با استفاده از سه کالکشن مجزا حل شود:
یک کالکشن برای کاربران، کالکشن دیگر برای دوره‌ها و یک کالکشن ارجاعی به نام `"کاربران_در_دوره‌ها"` که ثبت ثبت‌نام کاربران
در دوره‌ها را نگه می‌دارد.

**مزایا و ملاحظات هر روش:**

- **اسناد تو در تو:** ساده برای پیاده‌سازی و بهینه برای روابط یک به یک یا روابط نزدیکا وابسته. با این حال، با افزایش
  پیچیدگی روابط، اندازه اسناد اصلی ممکن است ناپایدار شود.
- **آرایه‌ها:** بهینه برای روابط یک به چند و امکان بازیابی آسان اسناد مرتبط از طریق شناسه‌های آن‌ها. با این حال، ممکن
  است نیاز به پرس‌وجوهای اضافی برای بازیابی اطلاعات کامل از اسناد مرجع باشد.
- **کالکشن‌های ارجاعی:** مناسب برای روابط پیچیده چند به چند. مقایسه با سایر روش‌ها، پیچیدگی بیشتری را معرفی می‌کند.

**انتخاب بهترین روش مدل‌سازی روابط:**

رویکرد بهینه برای مدل کردن روابط در MongoDB بستگی به ویژگی‌های خاص داده و الزامات برنامه شما دارد. عواملی مانند پیچیدگی
داده، الگوهای پرس‌وجو و سطح مطلوب نرمال‌سازی اسناد را با دقت مورد بررسی قرار دهید.