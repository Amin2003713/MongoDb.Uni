در MongoDB، درج‌ها می‌توانند به صورت مرتب یا بدون ترتیب باشند و این مسئله بر رفتار هنگام درج چندین سند با استفاده از
متد `insertMany` تأثیر مهمی دارد. در ادامه، یک بررسی جامع از درج‌های مرتب، درج‌های بدون ترتیب و ملاحظات استفاده از آن‌ها
را ارائه می‌دهیم:

**درج‌های مرتب:**

- **رفتار:** در هنگام انجام درج مرتب (`db.collection.insertMany(documents, { ordered: true })`)، MongoDB سعی می‌کند
  تمامی اسناد را به دقت در ترتیبی که در آرایه ارائه شده وجود دارند، درج کند. این اطمینان را می‌دهد که اسناد به صورت
  اتمیک درج شوند، به این معنی که یا همه اسناد موفق می‌شوند یا هیچ‌کدام. این حفظ سازگاری داده را تضمین می‌کند، زیرا وضعیت
  مجموعه‌ی داده‌ای فقط زمانی تغییر می‌کند که تمامی اسناد با موفقیت درج شوند.

- **رسیدگی به خطا:** اگر هنگام درج هر سندی در آرایه، خطایی رخ دهد، MongoDB عملیات کلی را متوقف کرده و هر سندی که با
  موفقیت درج شده است را باز می‌گرداند. این تضمین می‌کند که وضعیت مجموعه‌ی داده‌ای تنها زمانی تغییر می‌کند که تمامی اسناد
  با موفقیت درج شوند.

- **تأثیر عملکرد:** درج‌های مرتب ممکن است دارای بار مفیدی در مقایسه با درج‌های بدون ترتیب باشند. این به این دلیل است که
  MongoDB باید بررسی‌های اضافی انجام دهد تا ترتیب درج را اعمال کند و در صورت خطا، عملیات را بازپس‌گیری کند. بار معمولاً
  کم است، اما این یک عامل برای درج‌های گروهی بسیار بزرگ است.

**درج‌های بدون ترتیب (پیش‌فرض):**

- **رفتار:** هنگامی که یک درج بدون ترتیب انجام می‌دهید (`db.collection.insertMany(documents)`)، که رفتار پیش‌فرض است،
  MongoDB سعی می‌کند هر سند را به صورت مستقل و به صورت همزمان درج کند. این می‌تواند بهبود عملکرد را به ویژه برای
  مجموعه‌های داده‌ای بزرگ فراهم کند، زیرا چندین سند می‌توانند به صورت موازی درج شوند.

- **رسیدگی به خطا:** اگر هنگام درج یک سند خاص، خطایی رخ دهد، MongoDB ادامه پردازش سندهای باقیمانده در آرایه را ادامه
  می‌دهد. این همه سندها را درج می‌کند، حتی اگر برخی از درج‌ها نامو

- **موارد استفاده:** درج‌های بدون ترتیب مناسب هستند زمانی که:
  - **عملکرد اولویت است:** هنگام مواجهه با مجموعه‌های داده بسیار بزرگ، درج‌های بدون ترتیب می‌توانند با بهره‌گیری از
    پردازش موازی، سرعت درج را بهبود ببخشند.
  - **موفقیت جزئی قابل قبول است:** اگر برخی از شکست‌های درج اسند قابل قبول باشند و کافی باشد تا اسناد بیشتری درج شوند،
    درج‌های بدون ترتیب می‌توانند گزینه‌ای مناسب باشند.

**انتخاب بین درج‌های مرتب و بدون ترتیب:**

در زیر، چندین عامل کلیدی برای در نظر گرفتن در زمان تصمیم‌گیری بین درج‌های مرتب و بدون ترتیب آورده شده است:

- **سازگاری داده:** اگر حفظ ترتیب دقیق اسناد درج شده برای منطق برنامه‌ی شما اهمیت دارد (به عنوان مثال، درج یک سری
  معاملات به ترتیب خاص)، درج‌های مرتب را به اولویت ببخشید.
- **مقاومت در برابر خطا:** اگر برخی از شکست‌های درج اسند قابل قبول باشند و موفقیت جزئی کافی باشد، برای بهبود عملکرد، به
  ویژه برای مجموعه‌های داده بزرگ، درج‌های بدون ترتیب را در نظر بگیرید.
- **پشتیبانی از تراکنش:** درج‌های مرتب در داخل تراکنش‌های MongoDB پشتیبانی نمی‌شوند. اگر از تراکنش‌ها استفاده می‌کنید،
  باید در داخل زمینه تراکنش، درج‌های جداگانه اسناد را کنترل کنید تا اطمینان از اتمیکیت داشته باشید.

**مثال (استفاده از Shell):**

```bash
// درج مرتب (همه اسناد موفق می‌شوند یا هیچکدام)
db.products.insertMany([
  { name: "Shirt", price: 19.99 },  // این سند ممکن است دارای خطای اعتبارسنجی باشد
  { name: "Hat", price: 14.50 }
], { ordered: true })

// درج بدون ترتیب (ادامه درج حتی اگر یکی از آنها شکست بخورد)
db.products.insertMany([
  { name: "Shirt", price: 19.99 },  // این سند ممکن است دارای خطای اعتبارسنجی باشد
  { name: "Hat", price: 14.50 }
])
```

**رویکردهای جایگزین:**

- **درج‌های فردی:** اگر نیاز به کنترل دقیق بر روی درج‌های فردی اسناد و رسیدگی به خطا دارید، در نظر بگیرید که برای هر
  سند، عملیات جداگانه `insertOne` انجام دهید. این به شما کنترل دقیق‌تری بر روی فرایند درج را فراهم می‌کند، اما ممکن است
  بهترین رویکرد برای درج‌های گروهی نباشد.

- **عملیات‌های گروهی با رسیدگی به خطا:** کتابخانه‌هایی مانند راننده رسمی MongoDB برای Node.js (`mongodb`) عملیات‌های
  گروهی با امکان رسیدگی به خطا را ارائه می‌دهند. می‌توانید یک تابع بازخوانی را مشخص کنید تا خطاهای احتمالی را در زمان
  عملیات‌های گروهی مدیریت کند، که از انعطاف بیشتری نسبت به دستورات پایه خط فرمان فراهم می‌کند.

با درک ویژگی‌ها و موارد استفاده متمایز از درج‌های مرتب و بدون ترتیب، می‌توانید تصمیمات مطلعانه‌ای برای بهینه‌سازی
سازگاری داده، رسیدگی به خطا و عملکرد در برنامه‌های MongoDB خود اتخاذ کنید.
